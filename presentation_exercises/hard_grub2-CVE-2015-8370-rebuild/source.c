#include <stdlib.h>
#include <stdio.h>
#include <string.h>

static int username_get(char buf[], unsigned buf_size);
static int password_get(char buf[], unsigned buf_size);
static char storedUsername[] = "test";
static char storedPassword[] = "abc";

int main(int argc, char* argv[]) {
	int size = 1024;
	int error1 = 1;
	char username[size];
	int error2 = 2;
	char password[size];

	printf("Please enter your username: ");
	username_get(username,size);
	printf("Please enter your password: ");
	password_get(password,size);

	if((strcmp(username,storedUsername) == 0) && (strcmp(password,storedPassword) == 0)) {
		printf("Login successfull\n");
	} else {
		printf("Wrong username or password\n");
	}

	return 0;
}

static int username_get(char buf[], unsigned buf_size) {
	int cur_len = 0;
	int key;

	while (1) {
		key = getc(stdin);

		if (key == '\n' || key == '\r')
			break;

		if (key == '\e') {
			cur_len = 0;
			break;
		}

		if (key == '\b') {
			cur_len--;
			putc('\b', stdout);
			continue;
		}

		if (cur_len + 2 < buf_size) {
			buf[cur_len++] = key;
	          	putc(key, stdout);
			fflush(stdin);
		}
	}

	//cur_len = -32;
	memset(buf+cur_len,0,buf_size-cur_len);

	return (key != '\e');
}

static int password_get(char buf[], unsigned buf_size) {
	int cur_len = 0;
	int key;

	while (1) {
		key = getchar();

		if (key == '\n' || key == '\r')
			break;

		if (key == '\e') {
			cur_len = 0;
			break;
		}

		if (key == '\b') {
			cur_len--;
			printf("\b");
			continue;
		}

		if (cur_len + 2 < buf_size) {
			buf[cur_len++] = key;
	          	printf("%c", key);
			fflush(stdin);
		}
	}

	memset(buf+cur_len,0,buf_size-cur_len);
	printf("\n");

	return (key != '\e');
}
